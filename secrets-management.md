# Управление секретами

В проекте **Secret Vault** используются различные подходы для безопасного хранения, шифрования и передачи секретов между сервисами и внешними клиентами. Управление секретами реализовано с помощью Kubernetes Secrets, PersistentVolumeClaims и служб шифрования.

### 1. Kubernetes Secrets

Секреты хранятся в Kubernetes в зашифрованном виде и используются для передачи конфиденциальных данных, таких как учётные данные для баз данных или ключи API.

- **Файл манифеста**: `api-deployment.yaml`
- **Используемые переменные**:
  - `DB_USERNAME` и `DB_PASSWORD` для доступа к базе данных.
  
Пример секрета:
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
type: Opaque
data:
  username: bXktZGItdXNlcg==  # base64 кодировка для 'my-db-user'
  password: bXktZGItcGFzc3dvcmQ=  # base64 кодировка для 'my-db-password'
```

Этот секрет используется в контейнере для установления безопасного соединения с базой данных. Секреты безопасно монтируются в поды как переменные окружения или файлы.

### 2. Шифрование данных

Все данные, которые сохраняются в системе, шифруются сервисом шифрования перед сохранением. Для шифрования используется специальный микросервис, который обеспечивает безопасное хранение данных в зашифрованном виде.

- **Файл манифеста**: `encryption-deployment.yaml`
- **Основные задачи**:
  - Шифрование данных перед их сохранением.
  - Дешифрование данных при их запросе другими сервисами.

Шифрование и дешифрование реализовано в микросервисе через API, который вызывается другими компонентами системы.

### 3. PersistentVolume для ключей шифрования

Ключи шифрования, используемые сервисом Seal, хранятся на постоянном хранилище, обеспечивая надёжное восстановление после рестарта системы.

- **Файл манифеста**: `key-pvc.yaml`
- **Хранилище**: 1 GiB PersistentVolumeClaim

Этот PVC монтируется в контейнер Seal для хранения ключей шифрования. Это позволяет сохранять ключи даже после рестарта подов или при обновлениях системы.

### 4. Seal/Unseal механизм

Процесс "распечатывания" хранилища (unseal) — это ключевая часть безопасности системы. После запуска система должна быть распечатана для использования секретов.

- **Файл манифеста**: `seal-deployment.yaml`
- **Процесс**:
  - Система запрашивает ключи распечатывания при старте.
  - Механизм обеспечивает безопасность данных, не позволяя использовать систему без соответствующего ключа.

### 5. Версионирование секретов

Система поддерживает версионирование секретов, что позволяет сохранять и восстанавливать предыдущие версии секретов, если потребуется откат изменений.

- **Основные возможности**:
  - Хранение нескольких версий одного секрета.
  - Возможность отката к предыдущей версии при необходимости.
  - Удаление устаревших версий для управления пространством.
